<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <title>Autódromo Proxlive</title>

    <style>
        /* Estilo para o Card com Overlay que conversamos */
        .card-hover-overlay {
            position: relative;
            overflow: hidden;
        }

        .card-hover-overlay .card-img-top {
            transition: transform 0.4s ease;
        }

        .card-hover-overlay .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .card-hover-overlay:hover .overlay {
            opacity: 1;
        }

        .card-hover-overlay:hover .card-img-top {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">

    <header>
        <nav class="navbar justify-content-center mb-4">
            <a class="navbar-brand" href="#">
                <img src="img/ProXlive (1).png" height="50" alt="Logo ProXlive">
            </a>
        </nav>
    </header>

    <main>
        <div class="row gx-4">

            <div class="col-lg-8 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        Autódromo Chapecó-SC - Ao Vivo
                    </div>
                    <div class="card-body p-0">
                        <div class="ratio ratio-16x9">
                            <iframe 
                                src="https://rtspserver.zeusvision.com.br/9ff4c1ff-51dd-40e8-8a5a-f78b861d071a/" 
                                title="Câmera ao vivo do Autódromo" 
                                allowfullscreen
                                class="border-0">
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title mb-3">Deixe seu Comentário</h5>
                        <form id="form-comentario">
                            <div class="mb-2">
                                <label for="nome" class="form-label">Nome</label>
                                <input type="text" class="form-control" id="nome" required>
                            </div>
                            <div class="mb-3">
                                <label for="mensagem" class="form-label">Mensagem</label>
                                <textarea class="form-control" id="mensagem" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Enviar</button>
                        </form>
                        <hr class="my-3">
                        <div id="lista-de-comentarios" class="flex-grow-1" style="overflow-y: auto;">
                            <p class="text-center text-muted">Carregando comentários...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row gx-4">

            <div class="col-lg-8 mb-4">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card card-hover-overlay h-100 shadow-sm">
                            <img src="img/Design sem nome (51).png" class="card-img-top" alt="Parceiro 1">
                            <div class="overlay">
                                <h5 class="text-white">Parceiro 1</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card card-hover-overlay h-100 shadow-sm">
                             <img src="img/Design sem nome (49).png" class="card-img-top" alt="Parceiro 2">
                             <div class="overlay">
                                <h5 class="text-white">Parceiro 2</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card card-hover-overlay h-100 shadow-sm">
                             <img src="img/Design sem nome (50).png" class="card-img-top" alt="Parceiro 3">
                             <div class="overlay">
                                <h5 class="text-white">Parceiro 3</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h5 class="card-title">Painel Extra</h5>
                        <p class="card-text">Conteúdo adicional aqui.</p>
                    </div>
                </div>
            </div>
        </div>
        </main>
</div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" ...></script>


<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>


<script>
    // Sua firebaseConfig que você já tem (está correta)
    const firebaseConfig = {
      apiKey: "AIzaSyAtrmOP_ML4c8NF6P-HIiEwOEjis_vYtSc",
      authDomain: "autodromo-a84f7.firebaseapp.com",
      projectId: "autodromo-a84f7",
      storageBucket: "autodromo-a84f7.firebasestorage.app",
      messagingSenderId: "824754486879",
      appId: "1:824754486879:web:8313b53ebaae3d1f5165ea",
      measurementId: "G-3FEJ1SR5SW"
    };

    // Inicializa o Firebase e cria a variável 'db' que estava faltando
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(); 
</script>


<script>
    const formComentario = document.getElementById('form-comentario');
    const listaDeComentarios = document.getElementById('lista-de-comentarios');
    const nomeInput = document.getElementById('nome');
    const mensagemInput = document.getElementById('mensagem');
    
    // Agora a variável 'db' existe e esta linha funciona
    const colecaoComentarios = db.collection('comentarios');

    // FUNÇÃO PARA SALVAR UM NOVO COMENTÁRIO
    formComentario.addEventListener('submit', (e) => {
        e.preventDefault();
        if (nomeInput.value.trim() === '' || mensagemInput.value.trim() === '') return;

        colecaoComentarios.add({
            nome: nomeInput.value,
            mensagem: mensagemInput.value,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            formComentario.reset();
        })
        .catch((error) => {
            console.error("Erro ao salvar comentário: ", error);
        });
    });

    // FUNÇÃO PARA CARREGAR OS COMENTÁRIOS EM TEMPO REAL
    colecaoComentarios.orderBy('timestamp', 'desc').limit(50).onSnapshot((querySnapshot) => {
        listaDeComentarios.innerHTML = '';
        if (querySnapshot.empty) {
            listaDeComentarios.innerHTML = '<p class="text-center text-muted">Nenhum comentário ainda. Seja o primeiro!</p>';
        } else {
            querySnapshot.forEach((doc) => {
                const comentario = doc.data();
                const data = comentario.timestamp ? comentario.timestamp.toDate().toLocaleString('pt-BR') : '';
                
                const nomeSeguro = document.createTextNode(comentario.nome).textContent;
                const mensagemSegura = document.createTextNode(comentario.mensagem).textContent;

                const comentarioHTML = `
                    <div class="mb-3 border-bottom pb-2">
                        <p class="mb-0"><strong>${nomeSeguro}</strong> <small class="text-muted float-end">${data}</small></p>
                        <p class="mb-0">${mensagemSegura}</p>
                    </div>
                `;
                listaDeComentarios.innerHTML += comentarioHTML;
            });
        }
    });
</script>

<script>
    const formComentario = document.getElementById('form-comentario');
    const listaDeComentarios = document.getElementById('lista-de-comentarios');
    const nomeInput = document.getElementById('nome');
    const mensagemInput = document.getElementById('mensagem');
    const colecaoComentarios = db.collection('comentarios');

    // FUNÇÃO PARA SALVAR UM NOVO COMENTÁRIO
    formComentario.addEventListener('submit', (e) => {
        e.preventDefault();
        if (nomeInput.value.trim() === '' || mensagemInput.value.trim() === '') return;

        colecaoComentarios.add({
            nome: nomeInput.value,
            mensagem: mensagemInput.value,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            formComentario.reset();
        })
        .catch((error) => {
            console.error("Erro ao salvar comentário: ", error);
        });
    });

    // FUNÇÃO PARA CARREGAR OS COMENTÁRIOS EM TEMPO REAL
    colecaoComentarios.orderBy('timestamp', 'desc').limit(50).onSnapshot((querySnapshot) => {
        listaDeComentarios.innerHTML = '';
        if (querySnapshot.empty) {
            listaDeComentarios.innerHTML = '<p class="text-center text-muted">Nenhum comentário ainda. Seja o primeiro!</p>';
        } else {
            querySnapshot.forEach((doc) => {
                const comentario = doc.data();
                const data = comentario.timestamp ? comentario.timestamp.toDate().toLocaleString('pt-BR') : '';
                
                // Sanitiza o input do usuário para evitar injeção de HTML
                const nomeSeguro = document.createTextNode(comentario.nome).textContent;
                const mensagemSegura = document.createTextNode(comentario.mensagem).textContent;

                const comentarioHTML = `
                    <div class="mb-3 border-bottom pb-2">
                        <p class="mb-0"><strong>${nomeSeguro}</strong> <small class="text-muted float-end">${data}</small></p>
                        <p class="mb-0">${mensagemSegura}</p>
                    </div>
                `;
                listaDeComentarios.innerHTML += comentarioHTML;
            });
        }
    });
</script>

</body>
</html>